<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biblioteca Escolar</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #eef5ff;
  margin: 0; padding: 0;
}
header {
  background: #0059b3;
  color: white;
  text-align: center;
  padding: 15px;
}
.div-box {
  background: white;
  margin: 15px auto;
  padding: 15px;
  border-radius: 12px;
  width: 90%;
  max-width: 600px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
button {
  cursor: pointer;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  margin: 3px;
}
.btn-admin { background: #0059b3; color: white; }
.btn-aluno { background: #00994d; color: white; }
.btn-sair { background: #999; color: white; }
.btn-perigo { background: #cc0000; color: white; }
.hidden { display: none; }
input, select {
  width: 100%;
  padding: 6px;
  margin: 3px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
}
#mensagens {
  text-align: center;
  font-weight: bold;
  margin: 10px;
}
#mensagens.ok { color: green; }
#mensagens.err { color: red; }
</style>
</head>
<body>

<header><h1>Biblioteca Escolar</h1></header>

<main>
  <div id="mensagens"></div>

  <!-- MENU PRINCIPAL -->
  <div id="menuPrincipal" class="div-box">
    <h2>Bem-vindo!</h2>
    <p>Escolha seu tipo de acesso:</p>
    <button class="btn-aluno" id="btnSouAluno">Sou Aluno</button>
    <button class="btn-admin" id="btnSouAdmin">Sou Administrador</button>
  </div>

  <!-- LOGIN ALUNO -->
  <div id="loginAlunoDiv" class="div-box hidden">
    <h2>Login do Aluno</h2>
    <label>Nome:</label>
    <input type="text" id="alunoNome" autocomplete="off">
    <label>Senha:</label>
    <input type="password" id="alunoSenha" maxlength="4" pattern="\d{4}" inputmode="numeric" autocomplete="off" placeholder="4 dÃ­gitos">
    <div style="margin-top:8px;">
      <button class="btn-aluno" id="btnLoginAluno">Entrar</button>
      <button class="btn-sair" id="btnVoltarMenuFromAluno">Voltar</button>
    </div>
  </div>

  <!-- LOGIN ADMIN -->
  <div id="loginAdminDiv" class="div-box hidden">
    <h2>Login do Administrador</h2>
    <label>Senha:</label>
    <input type="password" id="senhaAdmin" autocomplete="off">
    <div style="margin-top:8px;">
      <button class="btn-admin" id="btnLoginAdmin">Entrar</button>
      <button class="btn-sair" id="btnVoltarMenuFromAdmin">Voltar</button>
    </div>
  </div>

  <!-- PAINEL ADMIN -->
  <div id="painelAdmin" class="div-box hidden">
    <h2>Painel do Administrador</h2>

    <h3>Adicionar Livro</h3>
    <label>TÃ­tulo:</label>
    <input type="text" id="tituloLivro" autocomplete="off">
    <label>PÃ¡ginas:</label>
    <input type="number" id="paginasLivro" min="1">
    <button class="btn-admin" id="btnAdicionarLivro">Adicionar</button>

    <h3>Gerenciar Alunos</h3>
    <label>Nome:</label>
    <input type="text" id="novoAlunoNome" autocomplete="off">
    <label>Senha:</label>
    <input type="password" id="novoAlunoSenha" maxlength="4" pattern="\d{4}" inputmode="numeric" autocomplete="off" placeholder="4 dÃ­gitos">
    <button class="btn-admin" id="btnAdicionarAluno">Cadastrar Aluno</button>

    <div id="listaAlunosAdmin" style="margin-top:10px;"></div>

    <h3>Lista de Livros</h3>
    <div id="listaLivrosAdmin" style="margin-top:8px;"></div>

    <div style="margin-top:12px;">
      <button class="btn-sair" id="btnLogoutAdmin">Sair</button>
      <button class="btn-perigo" id="btnLimparTudo">Limpar tudo</button>
    </div>
  </div>

  <!-- PAINEL ALUNO -->
  <div id="painelAluno" class="div-box hidden">
    <h2>Bem-vindo, <span id="nomeAlunoSpan"></span>!</h2>
    <input type="text" id="buscaLivroAluno" placeholder="Pesquisar livro..." autocomplete="off">
    <div id="listaLivrosAluno" style="margin-top:8px;"></div>
    <div style="margin-top:12px;">
      <button class="btn-sair" id="btnLogoutAluno">Sair</button>
    </div>
  </div>

</main>

<script>
const SENHA_ADMIN_FIXA = "admin123";
let livros = safeParse(localStorage.getItem("livros")) || [];
let alunos = safeParse(localStorage.getItem("alunos")) || [];
let alunoAtual = null;
let adminLogado = false;

function safeParse(raw) {
  try { return raw ? JSON.parse(raw) : null; } catch(e){ return null; }
}
function showMessage(msg, tipo="ok") {
  const div = document.getElementById("mensagens");
  div.textContent = msg;
  div.className = tipo;
  setTimeout(() => div.textContent = "", 3000);
}
function esconderTodos() {
  document.querySelectorAll("main > div.div-box").forEach(d => d.classList.add("hidden"));
}
function gerarId(prefixo) {
  return prefixo + "_" + Math.random().toString(36).substr(2,9);
}
function salvarTudo() {
  localStorage.setItem("livros", JSON.stringify(livros));
  localStorage.setItem("alunos", JSON.stringify(alunos));
}

/* ---- ADMIN ---- */
function adicionarLivro() {
  const titulo = (document.getElementById("tituloLivro").value || "").trim();
  const paginas = parseInt(document.getElementById("paginasLivro").value);
  if (!titulo || !paginas) { showMessage("Preencha tÃ­tulo e pÃ¡ginas.", "err"); return; }
  livros.push({ id: gerarId("livro"), titulo, paginas, disponivel: true, emprestadoPara: null });
  salvarTudo();
  document.getElementById("tituloLivro").value = "";
  document.getElementById("paginasLivro").value = "";
  showMessage("Livro adicionado.", "ok");
  atualizarListasAdmin();
}
function removerLivro(id) {
  if (!confirm("Remover este livro?")) return;
  livros = livros.filter(l => l.id !== id);
  salvarTudo();
  atualizarListasAdmin();
  showMessage("Livro removido.", "ok");
}
function adicionarAluno() {
  const nome = (document.getElementById("novoAlunoNome").value || "").trim();
  const senha = (document.getElementById("novoAlunoSenha").value || "").trim();
  if (!nome || !senha) { showMessage("Nome e senha obrigatÃ³rios.", "err"); return; }
  if (!/^\d{4}$/.test(senha)) { showMessage("A senha deve conter 4 dÃ­gitos numÃ©ricos.", "err"); return; }
  if (alunos.some(a => a.nome.toLowerCase() === nome.toLowerCase())) { showMessage("Aluno jÃ¡ cadastrado.", "err"); return; }
  alunos.push({ id: gerarId("aluno"), nome, senha });
  salvarTudo();
  document.getElementById("novoAlunoNome").value = "";
  document.getElementById("novoAlunoSenha").value = "";
  showMessage("Aluno cadastrado.", "ok");
  atualizarListasAdmin();
}
function removerAluno(id) {
  if (!confirm("Remover este aluno?")) return;
  alunos = alunos.filter(a => a.id !== id);
  salvarTudo();
  atualizarListasAdmin();
  showMessage("Aluno removido.", "ok");
}
function atualizarListasAdmin() {
  const divA = document.getElementById("listaAlunosAdmin");
  divA.innerHTML = alunos.map(a => 
    `<div>${a.nome} <button class="btn-perigo" onclick="removerAluno('${a.id}')">ğŸ—‘ï¸ Excluir</button></div>`
  ).join("");
  const divL = document.getElementById("listaLivrosAdmin");
  divL.innerHTML = livros.map(l => 
    `<div>${l.titulo} - ${l.disponivel ? "ğŸŸ¢ DisponÃ­vel" : "ğŸ”´ Emprestado para " + l.emprestadoPara}
     <button class="btn-perigo" onclick="removerLivro('${l.id}')">ğŸ—‘ï¸ Excluir</button></div>`
  ).join("");
}

/* ---- ALUNO ---- */
function loginAluno() {
  const nome = (document.getElementById("alunoNome").value || "").trim();
  const senha = document.getElementById("alunoSenha").value || "";
  if (!nome || !senha) { showMessage("Preencha nome e senha.", "err"); return; }
  if (!/^\d{4}$/.test(senha)) { showMessage("A senha deve conter 4 dÃ­gitos numÃ©ricos.", "err"); return; }

  const aluno = alunos.find(a => a.nome.toLowerCase() === nome.toLowerCase() && a.senha === senha);
  if (!aluno) { showMessage("Aluno nÃ£o encontrado ou senha incorreta.", "err"); return; }

  alunoAtual = aluno;
  esconderTodos();
  document.getElementById("painelAluno").classList.remove("hidden");
  document.getElementById("nomeAlunoSpan").textContent = alunoAtual.nome;
  atualizarListaAluno();
  showMessage("Login de aluno bem-sucedido.", "ok");
}
function atualizarListaAluno() {
  const div = document.getElementById("listaLivrosAluno");
  div.innerHTML = livros.map(l => {
    if (l.disponivel)
      return `<div>${l.titulo} - ğŸŸ¢ DisponÃ­vel <button class="btn-aluno" onclick="pegarLivro('${l.id}')">ğŸ“˜ Pegar</button></div>`;
    else if (l.emprestadoPara === alunoAtual.nome)
      return `<div>${l.titulo} - ğŸ“• Com vocÃª <button class="btn-sair" onclick="devolverLivro('${l.id}')">ğŸ“— Devolver</button></div>`;
    else
      return `<div>${l.titulo} - ğŸ”´ Emprestado para ${l.emprestadoPara}</div>`;
  }).join("");
}
function pegarLivro(id) {
  const livro = livros.find(l => l.id === id);
  if (!livro || !livro.disponivel) return;
  livro.disponivel = false;
  livro.emprestadoPara = alunoAtual.nome;
  salvarTudo();
  atualizarListaAluno();
  atualizarListasAdmin();
  showMessage(`VocÃª pegou "${livro.titulo}".`, "ok");
}
function devolverLivro(id) {
  const livro = livros.find(l => l.id === id);
  if (!livro || livro.disponivel) return;
  livro.disponivel = true;
  livro.emprestadoPara = null;
  salvarTudo();
  atualizarListaAluno();
  atualizarListasAdmin();
  showMessage(`VocÃª devolveu "${livro.titulo}".`, "ok");
}

/* ---- EVENTOS ---- */
document.getElementById("btnSouAluno").onclick = () => { esconderTodos(); document.getElementById("loginAlunoDiv").classList.remove("hidden"); };
document.getElementById("btnSouAdmin").onclick = () => { esconderTodos(); document.getElementById("loginAdminDiv").classList.remove("hidden"); };
document.getElementById("btnVoltarMenuFromAluno").onclick = () => { esconderTodos(); document.getElementById("menuPrincipal").classList.remove("hidden"); };
document.getElementById("btnVoltarMenuFromAdmin").onclick = () => { esconderTodos(); document.getElementById("menuPrincipal").classList.remove("hidden"); };

document.getElementById("btnLoginAluno").onclick = loginAluno;
document.getElementById("btnLoginAdmin").onclick = () => {
  const senha = document.getElementById("senhaAdmin").value;
  if (senha === SENHA_ADMIN_FIXA) {
    adminLogado = true;
    esconderTodos();
    document.getElementById("painelAdmin").classList.remove("hidden");
    atualizarListasAdmin();
    showMessage("Login de administrador bem-sucedido.", "ok");
  } else showMessage("Senha incorreta.", "err");
};
document.getElementById("btnLogoutAluno").onclick = () => { alunoAtual = null; esconderTodos(); document.getElementById("menuPrincipal").classList.remove("hidden"); showMessage("Logout efetuado.", "ok"); };
document.getElementById("btnLogoutAdmin").onclick = () => { adminLogado = false; esconderTodos(); document.getElementById("menuPrincipal").classList.remove("hidden"); showMessage("Logout efetuado.", "ok"); };

document.getElementById("btnAdicionarLivro").onclick = adicionarLivro;
document.getElementById("btnAdicionarAluno").onclick = adicionarAluno;
document.getElementById("btnLimparTudo").onclick = () => {
  if (confirm("Tem certeza que deseja limpar todos os dados?")) {
    localStorage.clear(); livros=[]; alunos=[];
    atualizarListasAdmin();
    showMessage("Banco de dados limpo.", "ok");
  }
};
</script>
</body>
</html>
